# 虚数

## 虚树的介绍

1. 某些问题涉及若干关键节点，关键节点是决定答案的关键。
2. 整棵树上保留关键节点，保留任意两个关键点之间的最低公共祖先。
3. 形成的树叫做虚树。

## 虚树的使用场景

1. 每个问题都涉及一批关键节点，但是所有问题的关键节点总量并不巨大。
2. 每个问题根据关键节点建立虚树，在虚树上求解原问题。
3. 因为虚树的规模小，所以复杂度得到优化。

## 虚树的建树方式

1. 二次排序 + LCA连边（推荐第一种建树方式，因为流程很容易记住）
2. 单调栈

虚树大小 `O(k)` ，建树复杂度 `O(k * log n)` ， `k` 是关键节点数量， `log n` 是整树上查询 `lca` 的复杂度。虚树的头节点不一定是整棵树的头节点。有时会把整棵树的头节点额外加入虚树，让虚树多一个祖先节点。通过这种处理，方便某些问题的求解，一般情况下，虚树只需要上连下，并不需要下连上，除非求解问题需要这么做。
